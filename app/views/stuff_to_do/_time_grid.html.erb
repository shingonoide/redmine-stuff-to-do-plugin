<div id="time-grid">
<h2><%= l(:stuff_to_do_time_grid) %></h2>

<div id="time-grid-error" class="flash error" style="display:none"> </div>

<%= render :partial => 'time_grid_form' %>

<table class="cal" id="time-grid-table">
  <thead>
    <tr>
      <th class="time-grid-project"><%= l(:field_project) %></th>
      <th class="time-grid-issue"><%= l(:field_issue) %></th>
      <% day = @calendar.startdt
      while day <= @calendar.enddt %>
      <th class="time-grid-date">
        <%= day_name(day.cwday) %>
        <br />
        <%= day.day %>
      </th>
      <% day = day + 1 %>
      <% end %>
      <th class="time-grid-running-total">Running Total</th>
    </tr>
  </thead>
  <tbody>
    <% @issues.each do |issue| %>
    <% content_tag_for(:tr, issue) do %>
      <td class="time-grid-project">
        <%= link_to(h(issue.project), :controller => 'projects', :action => 'show', :id => issue.project) %>
      </td>
      <td class="time-grid-issue">
        <%= link_to("##{issue.id} " + h(issue.subject), :controller => 'issues', :action => 'show', :id => issue) %>
      </td>
      <% day = @calendar.startdt
      while day <= @calendar.enddt %>
      <td class="time-grid-date <%= h day -%>">
        <%= h total_hours_for_user_on_day(issue, User.current, day) %>
      </td>
      <% day = day + 1 %>
      <% end %>
      <td class="time-grid-running-total issue-<%= h issue.id -%>">
        <%= h total_hours_for_issue_for_date_range(issue, User.current, @calendar.startdt, @calendar.enddt) %>
      </td>
    <% end %>
    <% end %>
    <tr class="daily-totals">
      <td colspan="2" class="label">
        Daily Totals
      </td>
      <% day = @calendar.startdt
      while day <= @calendar.enddt %>
      <td class="time-grid-date totals <%= h day -%>">
        <%= h total_hours_for_date(@issues, User.current, day) %>
      </td>
      <% day = day + 1 %>
      <% end %>
      <td class="time-grid-grand-total">
        <%= h total_hours_for_date_range(@issues, User.current, @calendar.startdt, @calendar.enddt) %>
      </td>
    </tr>

  </tbody>
</table>

</div>